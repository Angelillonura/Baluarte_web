<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Baluarte | Engineering & Technology</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Three.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">

    <!-- Markdown Parser (for AI responses) -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: {
                            yellow: '#F59E0B',   /* amber-500 */
                            orange: '#EA580C',   /* orange-600 */
                            red: '#DC2626',      /* red-600 */
                            dark: '#0A0A0A',
                            gray: '#171717',
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        display: ['Space Grotesk', 'sans-serif'],
                    },
                    animation: {
                        'float': 'float 6s ease-in-out infinite',
                        'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-20px)' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #050505;
            color: #ffffff;
            overflow-x: hidden;
        }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #0A0A0A; 
        }
        ::-webkit-scrollbar-thumb {
            background: #333; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #EA580C; 
        }

        /* 3D Canvas Background */
        #canvas-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            opacity: 0.6;
            pointer-events: none; /* Let clicks pass through */
        }

        /* Gradient Text */
        .text-gradient {
            background: linear-gradient(to right, #F59E0B, #EA580C, #DC2626);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .bg-gradient-brand {
            background: linear-gradient(135deg, #F59E0B 0%, #EA580C 50%, #DC2626 100%);
        }

        .glass-panel {
            background: rgba(23, 23, 23, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        /* Modal Transitions */
        .modal {
            transition: opacity 0.3s ease, visibility 0.3s ease;
            opacity: 0;
            visibility: hidden;
        }
        .modal.active {
            opacity: 1;
            visibility: visible;
        }

        /* Chat Widget Animations */
        .chat-enter {
            animation: slideInUp 0.3s ease-out forwards;
        }
        @keyframes slideInUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .typing-dot {
            animation: typing 1.4s infinite ease-in-out both;
        }
        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }
        @keyframes typing {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }
    </style>
</head>
<body class="font-sans antialiased selection:bg-brand-orange selection:text-white">

    <!-- 3D Background -->
    <div id="canvas-container"></div>

    <!-- GLOBAL PAGE OVERLAY FOR FOCUS MODE -->
    <!-- This sits above everything else (z-55) except the active card which will be z-60 -->
    <div id="focus-overlay" class="fixed inset-0 bg-black/80 backdrop-blur-sm z-[55] opacity-0 pointer-events-none transition-opacity duration-500"></div>

    <!-- Navigation -->
    <nav class="fixed w-full z-50 top-0 transition-all duration-300" id="navbar">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-20">
                <!-- Logo -->
                <div class="flex-shrink-0 flex items-center gap-2 cursor-pointer" onclick="window.scrollTo(0,0)">
                    <div class="w-8 h-8 bg-gradient-brand rounded flex items-center justify-center transform rotate-45">
                        <span class="text-white font-bold text-lg -rotate-45">B</span>
                    </div>
                    <span class="font-display font-bold text-2xl tracking-tight text-white">BALUARTE</span>
                </div>

                <!-- Desktop Menu -->
                <div class="hidden md:flex space-x-8 items-center">
                    <a href="#projects" data-i18n="nav_projects" class="text-gray-300 hover:text-brand-yellow transition-colors text-sm uppercase tracking-widest font-medium">Projects</a>
                    <a href="#services" data-i18n="nav_services" class="text-gray-300 hover:text-brand-yellow transition-colors text-sm uppercase tracking-widest font-medium">Services</a>
                    
                    <!-- Language Switcher Desktop -->
                    <button onclick="toggleLanguage()" class="text-gray-300 hover:text-white font-medium text-sm border border-gray-600 rounded px-2 py-1 transition-colors">
                        <span id="lang-btn-text">ES</span>
                    </button>

                    <a href="#contact" data-i18n="nav_contact" class="px-5 py-2 bg-white text-black font-bold rounded-full hover:bg-brand-yellow hover:text-white transition-all transform hover:scale-105">
                        Contact Us
                    </a>
                </div>

                <!-- Mobile Menu Button -->
                <div class="md:hidden flex items-center gap-4">
                    <!-- Language Switcher Mobile -->
                    <button onclick="toggleLanguage()" class="text-gray-300 hover:text-white font-medium text-sm border border-gray-600 rounded px-2 py-1">
                        <span id="lang-btn-text-mobile">ES</span>
                    </button>

                    <button id="mobile-menu-btn" class="text-white hover:text-brand-yellow focus:outline-none">
                        <i class="fas fa-bars text-2xl"></i>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Mobile Menu Panel -->
        <div id="mobile-menu" class="hidden md:hidden bg-brand-dark border-b border-gray-800">
            <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
                <a href="#projects" data-i18n="nav_projects" class="block px-3 py-2 text-base font-medium text-gray-300 hover:text-white hover:bg-gray-800 rounded-md">Projects</a>
                <a href="#services" data-i18n="nav_services" class="block px-3 py-2 text-base font-medium text-gray-300 hover:text-white hover:bg-gray-800 rounded-md">Services</a>
                <a href="#contact" data-i18n="nav_contact" class="block px-3 py-2 text-base font-bold text-brand-yellow hover:text-brand-orange">Contact Us</a>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="relative min-h-screen flex items-center justify-center pt-20 overflow-hidden">
        <div class="absolute bottom-10 left-1/2 transform -translate-x-1/2 animate-bounce text-gray-500">
            <i class="fas fa-chevron-down text-xl"></i>
        </div>
        
        <div class="relative z-10 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <div class="inline-block px-4 py-1.5 mb-6 border border-brand-orange/30 rounded-full bg-brand-orange/10 backdrop-blur-sm">
                <span data-i18n="hero_tag" class="text-brand-orange font-semibold tracking-wide text-xs uppercase">Precision Engineering</span>
            </div>
            
            <h1 class="text-5xl md:text-7xl lg:text-8xl font-display font-bold leading-tight mb-8">
                <span data-i18n="hero_title_1">Building the</span> <br>
                <span data-i18n="hero_title_2" class="text-gradient">Core of Industry</span>
            </h1>
            
            <p data-i18n="hero_desc" class="mt-4 max-w-2xl mx-auto text-xl text-gray-400 font-light leading-relaxed">
                Baluarte develops high-precision technology for B2B partners. 
                From automotive fixtures to complex assembly machinery parts.
            </p>

            <div class="mt-10 flex flex-col sm:flex-row gap-4 justify-center">
                <a href="#projects" data-i18n="btn_catalog" class="px-8 py-4 bg-gradient-brand text-white font-bold rounded hover:opacity-90 transition-all shadow-lg shadow-brand-orange/20">
                    View Catalog
                </a>
                <a href="#contact" data-i18n="btn_meeting" class="px-8 py-4 bg-transparent border border-gray-600 text-white font-bold rounded hover:border-brand-yellow hover:text-brand-yellow transition-all">
                    Schedule Meeting
                </a>
            </div>
        </div>
    </section>

    <!-- Services Banner -->
    <div id="services" class="bg-brand-dark border-y border-gray-800 relative z-20 transition-all duration-300">
        <div class="max-w-7xl mx-auto py-12 px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8 text-center md:text-left">
                
                <!-- Service 1 -->
                <div class="service-card p-6 rounded-xl relative overflow-hidden group transition-all duration-300 transform"
                     onmouseenter="focusService(this)" 
                     onmouseleave="blurService(this)">
                    
                    <!-- Background Hover Effect -->
                    <div class="absolute inset-0 bg-white/5 opacity-0 group-hover:opacity-100 transition duration-300"></div>
                    
                    <!-- Content -->
                    <div class="relative z-10 transition-all duration-500 group-hover:blur-sm">
                        <div class="w-12 h-12 bg-gray-800 rounded-lg flex items-center justify-center mb-4 group-hover:bg-brand-yellow/20 transition-colors">
                            <i class="fas fa-microchip text-brand-yellow text-xl"></i>
                        </div>
                        <h3 data-i18n="service_1_title" class="text-xl font-bold text-white mb-2">Automotive Electronics</h3>
                        <p data-i18n="service_1_desc" class="text-gray-400 text-sm">Custom fixtures designed for testing and assembly of sensitive electronic components.</p>
                    </div>

                    <!-- HOVER CARD -->
                    <div class="absolute inset-0 z-20 bg-gray-900/80 backdrop-blur-xl border border-brand-yellow/30 opacity-0 group-hover:opacity-100 transition-all duration-500 transform translate-y-4 group-hover:translate-y-0 flex flex-col justify-center px-6 text-left shadow-2xl">
                        <h4 class="text-brand-yellow font-bold text-sm uppercase mb-2">Technical Specs</h4>
                        <ul class="text-xs text-white space-y-1 list-disc pl-4 shadow-black drop-shadow-md">
                            <li>ESD safe materials</li>
                            <li>±0.01mm tolerance</li>
                            <li>Pneumatic integration</li>
                            <li>High-temp resistance</li>
                        </ul>
                    </div>
                </div>

                <!-- Service 2 -->
                <div class="service-card p-6 rounded-xl relative overflow-hidden group transition-all duration-300 transform"
                     onmouseenter="focusService(this)" 
                     onmouseleave="blurService(this)">

                    <div class="absolute inset-0 bg-white/5 opacity-0 group-hover:opacity-100 transition duration-300"></div>
                    
                    <!-- Content -->
                    <div class="relative z-10 transition-all duration-500 group-hover:blur-sm">
                        <div class="w-12 h-12 bg-gray-800 rounded-lg flex items-center justify-center mb-4 group-hover:bg-brand-orange/20 transition-colors">
                            <i class="fas fa-cogs text-brand-orange text-xl"></i>
                        </div>
                        <h3 data-i18n="service_2_title" class="text-xl font-bold text-white mb-2">Assembly Machinery</h3>
                        <p data-i18n="service_2_desc" class="text-gray-400 text-sm">High-tolerance mechanical parts manufactured for automated assembly lines.</p>
                    </div>

                    <!-- HOVER CARD -->
                     <div class="absolute inset-0 z-20 bg-gray-900/80 backdrop-blur-xl border border-brand-orange/30 opacity-0 group-hover:opacity-100 transition-all duration-500 transform translate-y-4 group-hover:translate-y-0 flex flex-col justify-center px-6 text-left shadow-2xl">
                        <h4 class="text-brand-orange font-bold text-sm uppercase mb-2">Capabilities</h4>
                        <ul class="text-xs text-white space-y-1 list-disc pl-4 shadow-black drop-shadow-md">
                            <li>CNC Milling (5-Axis)</li>
                            <li>Hardened Steel / Alloys</li>
                            <li>Surface Treatments</li>
                            <li>Low & High Volume</li>
                        </ul>
                    </div>
                </div>

                <!-- Service 3 -->
                <div class="service-card p-6 rounded-xl relative overflow-hidden group transition-all duration-300 transform"
                     onmouseenter="focusService(this)" 
                     onmouseleave="blurService(this)">

                    <div class="absolute inset-0 bg-white/5 opacity-0 group-hover:opacity-100 transition duration-300"></div>
                    
                    <!-- Content -->
                    <div class="relative z-10 transition-all duration-500 group-hover:blur-sm">
                        <div class="w-12 h-12 bg-gray-800 rounded-lg flex items-center justify-center mb-4 group-hover:bg-brand-red/20 transition-colors">
                            <i class="fas fa-drafting-compass text-brand-red text-xl"></i>
                        </div>
                        <h3 data-i18n="service_3_title" class="text-xl font-bold text-white mb-2">Custom Prototyping</h3>
                        <p data-i18n="service_3_desc" class="text-gray-400 text-sm">Rapid development of functional prototypes to validate engineering concepts.</p>
                    </div>

                    <!-- HOVER CARD -->
                    <div class="absolute inset-0 z-20 bg-gray-900/80 backdrop-blur-xl border border-brand-red/30 opacity-0 group-hover:opacity-100 transition-all duration-500 transform translate-y-4 group-hover:translate-y-0 flex flex-col justify-center px-6 text-left shadow-2xl">
                        <h4 class="text-brand-red font-bold text-sm uppercase mb-2">Rapid Dev</h4>
                        <ul class="text-xs text-white space-y-1 list-disc pl-4 shadow-black drop-shadow-md">
                            <li>3D Printing (SLA/FDM)</li>
                            <li>Aluminum Fast-Machining</li>
                            <li>Design Optimization</li>
                            <li>48h Turnaround</li>
                        </ul>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- Projects Catalog -->
    <section id="projects" class="py-24 relative z-20 bg-black/80 backdrop-blur-md">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex flex-col md:flex-row justify-between items-end mb-16">
                <div>
                    <h2 data-i18n="projects_title" class="text-4xl md:text-5xl font-display font-bold text-white mb-4">Our Projects</h2>
                    <div class="h-1 w-24 bg-gradient-brand"></div>
                </div>
                <p data-i18n="projects_subtitle" class="text-gray-400 mt-4 md:mt-0 max-w-md text-right">
                    Explore our recent developments in industrial automation and tooling.
                </p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                <!-- Project Card 1 -->
                <div class="group relative bg-brand-gray rounded-xl overflow-hidden border border-gray-800 hover:border-brand-orange transition-all duration-300 hover:shadow-2xl hover:shadow-brand-orange/10">
                    <div class="h-64 bg-gray-900 relative overflow-hidden flex items-center justify-center">
                        <div class="absolute inset-0 bg-gradient-to-t from-black to-transparent opacity-60 z-10"></div>
                        <i class="fas fa-car-battery text-6xl text-gray-700 group-hover:text-brand-yellow transition-colors duration-500 transform group-hover:scale-110"></i>
                    </div>
                    <div class="p-6 relative z-20">
                        <div data-i18n="cat_automotive" class="text-xs font-bold text-brand-yellow uppercase tracking-wider mb-2">Automotive</div>
                        <h3 data-i18n="proj_1_title" class="text-xl font-bold text-white mb-2">ECU Testing Fixture</h3>
                        <p data-i18n="proj_1_desc" class="text-gray-400 text-sm mb-4">A high-precision testing rig for automotive Engine Control Units with pneumatic locking.</p>
                        <!-- MODIFIED BUTTON -->
                        <button onclick="openProjectDetails(1)" class="inline-flex items-center text-white hover:text-brand-orange transition-colors text-sm font-semibold focus:outline-none">
                            <span data-i18n="btn_details">View Details</span> <i class="fas fa-arrow-right ml-2 text-xs"></i>
                        </button>
                    </div>
                </div>

                <!-- Project Card 2 -->
                <div class="group relative bg-brand-gray rounded-xl overflow-hidden border border-gray-800 hover:border-brand-orange transition-all duration-300 hover:shadow-2xl hover:shadow-brand-orange/10">
                    <div class="h-64 bg-gray-900 relative overflow-hidden flex items-center justify-center">
                        <div class="absolute inset-0 bg-gradient-to-t from-black to-transparent opacity-60 z-10"></div>
                         <i class="fas fa-robot text-6xl text-gray-700 group-hover:text-brand-orange transition-colors duration-500 transform group-hover:scale-110"></i>
                    </div>
                    <div class="p-6 relative z-20">
                        <div data-i18n="cat_robotics" class="text-xs font-bold text-brand-orange uppercase tracking-wider mb-2">Robotics</div>
                        <h3 data-i18n="proj_2_title" class="text-xl font-bold text-white mb-2">Arm End-Effector</h3>
                        <p data-i18n="proj_2_desc" class="text-gray-400 text-sm mb-4">Custom aluminum grip assembly for a 6-axis industrial robot arm used in packaging.</p>
                        <!-- MODIFIED BUTTON -->
                        <button onclick="openProjectDetails(2)" class="inline-flex items-center text-white hover:text-brand-orange transition-colors text-sm font-semibold focus:outline-none">
                            <span data-i18n="btn_details">View Details</span> <i class="fas fa-arrow-right ml-2 text-xs"></i>
                        </button>
                    </div>
                </div>

                <!-- Project Card 3 -->
                <div class="group relative bg-brand-gray rounded-xl overflow-hidden border border-gray-800 hover:border-brand-orange transition-all duration-300 hover:shadow-2xl hover:shadow-brand-orange/10">
                    <div class="h-64 bg-gray-900 relative overflow-hidden flex items-center justify-center">
                        <div class="absolute inset-0 bg-gradient-to-t from-black to-transparent opacity-60 z-10"></div>
                         <i class="fas fa-gears text-6xl text-gray-700 group-hover:text-brand-red transition-colors duration-500 transform group-hover:scale-110"></i>
                    </div>
                    <div class="p-6 relative z-20">
                        <div data-i18n="cat_machinery" class="text-xs font-bold text-brand-red uppercase tracking-wider mb-2">Machinery</div>
                        <h3 data-i18n="proj_3_title" class="text-xl font-bold text-white mb-2">Conveyor Drive Shaft</h3>
                        <p data-i18n="proj_3_desc" class="text-gray-400 text-sm mb-4">Reinforced steel drive shafts manufactured for heavy-load assembly machinery.</p>
                        <!-- MODIFIED BUTTON -->
                        <button onclick="openProjectDetails(3)" class="inline-flex items-center text-white hover:text-brand-orange transition-colors text-sm font-semibold focus:outline-none">
                            <span data-i18n="btn_details">View Details</span> <i class="fas fa-arrow-right ml-2 text-xs"></i>
                        </button>
                    </div>
                </div>
                 <!-- Project Card 4 -->
                 <div class="group relative bg-brand-gray rounded-xl overflow-hidden border border-gray-800 hover:border-brand-orange transition-all duration-300 hover:shadow-2xl hover:shadow-brand-orange/10">
                    <div class="h-64 bg-gray-900 relative overflow-hidden flex items-center justify-center">
                        <div class="absolute inset-0 bg-gradient-to-t from-black to-transparent opacity-60 z-10"></div>
                         <i class="fas fa-charging-station text-6xl text-gray-700 group-hover:text-brand-yellow transition-colors duration-500 transform group-hover:scale-110"></i>
                    </div>
                    <div class="p-6 relative z-20">
                        <div data-i18n="cat_ev" class="text-xs font-bold text-brand-yellow uppercase tracking-wider mb-2">EV Tech</div>
                        <h3 data-i18n="proj_4_title" class="text-xl font-bold text-white mb-2">Battery Housing Jig</h3>
                        <p data-i18n="proj_4_desc" class="text-gray-400 text-sm mb-4">Precision jig for welding electric vehicle battery packs with heat dissipation integration.</p>
                        <!-- MODIFIED BUTTON -->
                        <button onclick="openProjectDetails(4)" class="inline-flex items-center text-white hover:text-brand-orange transition-colors text-sm font-semibold focus:outline-none">
                            <span data-i18n="btn_details">View Details</span> <i class="fas fa-arrow-right ml-2 text-xs"></i>
                        </button>
                    </div>
                </div>

                <!-- Project Card 5 -->
                <div class="group relative bg-brand-gray rounded-xl overflow-hidden border border-gray-800 hover:border-brand-orange transition-all duration-300 hover:shadow-2xl hover:shadow-brand-orange/10">
                    <div class="h-64 bg-gray-900 relative overflow-hidden flex items-center justify-center">
                        <div class="absolute inset-0 bg-gradient-to-t from-black to-transparent opacity-60 z-10"></div>
                         <i class="fas fa-microscope text-6xl text-gray-700 group-hover:text-brand-orange transition-colors duration-500 transform group-hover:scale-110"></i>
                    </div>
                    <div class="p-6 relative z-20">
                        <div data-i18n="cat_qc" class="text-xs font-bold text-brand-orange uppercase tracking-wider mb-2">Quality Control</div>
                        <h3 data-i18n="proj_5_title" class="text-xl font-bold text-white mb-2">Vision System Mount</h3>
                        <p data-i18n="proj_5_desc" class="text-gray-400 text-sm mb-4">Adjustable multi-axis mount for automated optical inspection cameras.</p>
                        <!-- MODIFIED BUTTON -->
                        <button onclick="openProjectDetails(5)" class="inline-flex items-center text-white hover:text-brand-orange transition-colors text-sm font-semibold focus:outline-none">
                            <span data-i18n="btn_details">View Details</span> <i class="fas fa-arrow-right ml-2 text-xs"></i>
                        </button>
                    </div>
                </div>

                <!-- Project Card 6 -->
                <div class="group relative bg-brand-gray rounded-xl overflow-hidden border border-gray-800 hover:border-brand-orange transition-all duration-300 hover:shadow-2xl hover:shadow-brand-orange/10">
                    <div class="h-64 bg-gray-900 relative overflow-hidden flex items-center justify-center">
                        <div class="absolute inset-0 bg-gradient-to-t from-black to-transparent opacity-60 z-10"></div>
                         <i class="fas fa-shield-alt text-6xl text-gray-700 group-hover:text-brand-red transition-colors duration-500 transform group-hover:scale-110"></i>
                    </div>
                    <div class="p-6 relative z-20">
                        <div data-i18n="cat_defense" class="text-xs font-bold text-brand-red uppercase tracking-wider mb-2">Defense</div>
                        <h3 data-i18n="proj_6_title" class="text-xl font-bold text-white mb-2">Ruggedized Enclosure</h3>
                        <p data-i18n="proj_6_desc" class="text-gray-400 text-sm mb-4">Machined aluminum enclosure for field communications equipment.</p>
                        <!-- MODIFIED BUTTON -->
                        <button onclick="openProjectDetails(6)" class="inline-flex items-center text-white hover:text-brand-orange transition-colors text-sm font-semibold focus:outline-none">
                            <span data-i18n="btn_details">View Details</span> <i class="fas fa-arrow-right ml-2 text-xs"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Contact & Calendar Section -->
    <section id="contact" class="py-24 relative z-20">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-12">
                
                <!-- Contact Form -->
                <div class="bg-brand-gray/80 backdrop-blur border border-gray-800 rounded-2xl p-8 lg:p-12 shadow-2xl">
                    <div class="flex justify-between items-start mb-6">
                        <div>
                            <h2 data-i18n="contact_title" class="text-3xl font-display font-bold text-white">Get in Touch</h2>
                            <p data-i18n="contact_desc" class="text-gray-400 mt-2">Ready to start your next engineering project? Send us a message.</p>
                        </div>
                    </div>
                    
                    <form action="https://formsubmit.co/angelillonura@gmail.com" method="POST" class="space-y-6">
                        <!-- CONFIGURACIÓN FORMSUBMIT -->
                        <input type="hidden" name="_captcha" value="false">
                        <input type="hidden" name="_template" value="table">
                        <input type="hidden" name="_subject" value="Nuevo contacto desde Baluarte">
                        <input type="hidden" name="_next" value="https://tusitio.com/gracias.html">

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label data-i18n="lbl_name" class="block text-sm text-gray-400 mb-2">Nombre</label>
                                <input type="text" name="Nombre" id="contactName" required class="w-full bg-black/50 border border-gray-700 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-brand-yellow focus:ring-1 focus:ring-brand-yellow transition-all" placeholder="John Doe">
                            </div>
                            <div>
                                <label data-i18n="lbl_company" class="block text-sm text-gray-400 mb-2">Empresa</label>
                                <input type="text" name="Empresa" id="contactCompany" required class="w-full bg-black/50 border border-gray-700 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-brand-yellow focus:ring-1 focus:ring-brand-yellow transition-all" placeholder="Acme Inc.">
                            </div>
                        </div>

                        <div>
                            <label data-i18n="lbl_email" class="block text-sm text-gray-400 mb-2">Email</label>
                            <input type="email" name="email" id="contactEmail" required class="w-full bg-black/50 border border-gray-700 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-brand-orange focus:ring-1 focus:ring-brand-orange transition-all" placeholder="john@company.com">
                        </div>

                        <div>
                            <label data-i18n="lbl_type" class="block text-sm text-gray-400 mb-2">Tipo de Proyecto</label>
                            <select name="Proyecto" id="contactType" class="w-full bg-black/50 border border-gray-700 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-brand-red focus:ring-1 focus:ring-brand-red transition-all">
                                <option data-i18n="opt_auto">Automotriz</option>
                                <option data-i18n="opt_machine">Maquinaria</option>
                                <option data-i18n="opt_proto">Prototipado</option>
                                <option data-i18n="opt_other">Otro</option>
                            </select>
                        </div>

                        <div class="relative">
                            <label data-i18n="lbl_message" class="block text-sm text-gray-400 mb-2">Mensaje</label>
                            <textarea name="Mensaje" id="contactMessage" rows="4" data-i18n-placeholder="pl_message" required class="w-full bg-black/50 border border-gray-700 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-brand-yellow focus:ring-1 focus:ring-brand-yellow transition-all" placeholder="Describe your requirements..."></textarea>
                            
                            <!-- Gemini AI Feature: Enhance Message -->
                            <button type="button" onclick="enhanceMessage()" class="absolute right-3 bottom-3 text-xs bg-brand-dark/80 hover:bg-brand-orange text-brand-yellow hover:text-white border border-brand-yellow/30 px-3 py-1.5 rounded-md transition-all flex items-center gap-1.5 backdrop-blur-sm">
                                <span id="enhanceBtnText" data-i18n="btn_enhance">Enhance with AI ✨</span>
                                <i id="enhanceIcon" class="fas fa-sparkles"></i>
                            </button>
                        </div>

                        <button type="submit" data-i18n="btn_send" class="w-full bg-gradient-to-r from-brand-yellow to-brand-orange text-white font-bold py-4 rounded-lg hover:opacity-90 transition-opacity shadow-lg">
                            Enviar Mensaje
                        </button>
                    </form>
                </div>

                <!-- Calendar Widget -->
                <div class="flex flex-col">
                    <div class="glass-panel rounded-2xl p-8 lg:p-12 h-full flex flex-col">
                        <h2 data-i18n="cal_title" class="text-3xl font-display font-bold text-white mb-2">Schedule a Meeting</h2>
                        <p data-i18n="cal_desc" class="text-gray-400 mb-8">Book a technical consultation with our engineers.</p>

                        <!-- Calendar UI -->
                        <div class="bg-black/40 rounded-xl p-6 border border-gray-700 flex-grow">
                            <div class="flex justify-between items-center mb-6">
                                <h3 class="text-white font-bold text-lg" id="currentMonthYear">November 2023</h3>
                                <div class="flex space-x-2">
                                    <button class="w-8 h-8 rounded-full bg-gray-800 hover:bg-gray-700 text-white flex items-center justify-center"><i class="fas fa-chevron-left"></i></button>
                                    <button class="w-8 h-8 rounded-full bg-gray-800 hover:bg-gray-700 text-white flex items-center justify-center"><i class="fas fa-chevron-right"></i></button>
                                </div>
                            </div>
                            
                            <!-- Days Header -->
                            <div class="grid grid-cols-7 mb-4 text-center">
                                <span data-i18n="day_su" class="text-xs font-bold text-gray-500 uppercase">Su</span>
                                <span data-i18n="day_mo" class="text-xs font-bold text-gray-500 uppercase">Mo</span>
                                <span data-i18n="day_tu" class="text-xs font-bold text-gray-500 uppercase">Tu</span>
                                <span data-i18n="day_we" class="text-xs font-bold text-gray-500 uppercase">We</span>
                                <span data-i18n="day_th" class="text-xs font-bold text-gray-500 uppercase">Th</span>
                                <span data-i18n="day_fr" class="text-xs font-bold text-gray-500 uppercase">Fr</span>
                                <span data-i18n="day_sa" class="text-xs font-bold text-gray-500 uppercase">Sa</span>
                            </div>

                            <!-- Calendar Grid -->
                            <div class="grid grid-cols-7 gap-2 text-center" id="calendarGrid">
                                <!-- Days will be injected here -->
                            </div>
                        </div>
                        
                        <div class="mt-6 p-4 bg-brand-yellow/10 border border-brand-yellow/20 rounded-lg flex items-start">
                            <i class="fas fa-info-circle text-brand-yellow mt-1 mr-3"></i>
                            <p data-i18n="cal_info" class="text-sm text-gray-300">Select an available date (highlighted) to request a Google Meet session.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-black py-12 border-t border-gray-900 relative z-20">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex flex-col md:flex-row justify-between items-center">
            <div class="flex items-center gap-2 mb-4 md:mb-0">
                <div class="w-6 h-6 bg-gradient-brand rounded flex items-center justify-center transform rotate-45">
                    <span class="text-white font-bold text-xs -rotate-45">B</span>
                </div>
                <span class="font-display font-bold text-xl text-white">BALUARTE</span>
            </div>
            <div class="text-gray-500 text-sm">
                &copy; 2024 Baluarte Engineering. <span data-i18n="footer_rights">All rights reserved.</span>
            </div>
            <div class="flex space-x-6 mt-4 md:mt-0">
                <a href="#" class="text-gray-500 hover:text-white transition-colors"><i class="fab fa-linkedin text-xl"></i></a>
                <a href="#" class="text-gray-500 hover:text-white transition-colors"><i class="fab fa-twitter text-xl"></i></a>
                <a href="#" class="text-gray-500 hover:text-white transition-colors"><i class="fab fa-instagram text-xl"></i></a>
            </div>
        </div>
    </footer>

    <!-- Chat Bot Widget -->
    <div class="fixed bottom-6 right-6 z-50">
        <!-- Chat Toggle Button -->
        <button onclick="toggleChat()" id="chatToggleBtn" class="w-14 h-14 bg-gradient-brand rounded-full flex items-center justify-center shadow-2xl hover:scale-105 transition-transform group">
            <i class="fas fa-comment-dots text-2xl text-white group-hover:hidden"></i>
            <i class="fas fa-robot text-2xl text-white hidden group-hover:block"></i>
        </button>

        <!-- Chat Window -->
        <div id="chatWindow" class="hidden absolute bottom-16 right-0 w-80 sm:w-96 bg-brand-gray border border-gray-700 rounded-2xl shadow-2xl overflow-hidden flex flex-col transition-all origin-bottom-right transform scale-95 opacity-0">
            <!-- Header -->
            <div class="bg-gray-900 p-4 border-b border-gray-800 flex justify-between items-center">
                <div class="flex items-center gap-3">
                    <div class="w-8 h-8 bg-brand-orange/20 rounded-full flex items-center justify-center">
                        <i class="fas fa-robot text-brand-orange text-sm"></i>
                    </div>
                    <div>
                        <h4 data-i18n="chat_title" class="font-bold text-white text-sm">Virtual Engineer</h4>
                        <span class="text-xs text-green-500 flex items-center gap-1"><span class="w-1.5 h-1.5 bg-green-500 rounded-full"></span> Online</span>
                    </div>
                </div>
                <button onclick="toggleChat()" class="text-gray-400 hover:text-white"><i class="fas fa-times"></i></button>
            </div>
            
            <!-- Messages Area -->
            <div id="chatMessages" class="flex-1 h-80 overflow-y-auto p-4 space-y-4 bg-black/50">
                <!-- Welcome Message -->
                <div class="flex items-start gap-3">
                    <div class="w-6 h-6 bg-brand-orange/20 rounded-full flex items-center justify-center flex-shrink-0 mt-1">
                        <i class="fas fa-robot text-brand-orange text-xs"></i>
                    </div>
                    <div class="bg-gray-800 text-gray-200 text-sm p-3 rounded-2xl rounded-tl-none border border-gray-700">
                        <span data-i18n="chat_welcome">Hello! I'm Baluarte's AI assistant. How can I help you with our fixtures or machinery services today?</span>
                    </div>
                </div>
            </div>

            <!-- Input Area -->
            <div class="p-4 bg-gray-900 border-t border-gray-800">
                <form onsubmit="handleChatSubmit(event)" class="relative">
                    <input type="text" id="chatInput" data-i18n-placeholder="chat_placeholder" class="w-full bg-black border border-gray-700 rounded-full pl-4 pr-10 py-2.5 text-sm text-white focus:outline-none focus:border-brand-orange transition-colors" placeholder="Ask about our fixtures...">
                    <button type="submit" class="absolute right-1 top-1 w-8 h-8 bg-brand-orange text-white rounded-full flex items-center justify-center hover:bg-brand-yellow transition-colors">
                        <i class="fas fa-paper-plane text-xs"></i>
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <!-- Message Success Modal -->
    <div id="successModal" class="modal fixed inset-0 z-[100] flex items-center justify-center px-4 bg-black/80 backdrop-blur-sm">
        <div class="bg-brand-gray border border-gray-700 p-8 rounded-2xl max-w-md w-full text-center relative overflow-hidden">
            <div class="absolute top-0 left-0 w-full h-1 bg-gradient-brand"></div>
            <div class="w-16 h-16 bg-green-500/20 rounded-full flex items-center justify-center mx-auto mb-4">
                <i class="fas fa-check text-green-500 text-2xl"></i>
            </div>
            <h3 data-i18n="modal_sent_title" class="text-2xl font-bold text-white mb-2">Message Sent</h3>
            <p data-i18n="modal_sent_desc" class="text-gray-400 mb-6">Thank you for contacting Baluarte. Our engineering team will review your inquiry and respond within 24 hours.</p>
            <button onclick="closeModal('successModal')" data-i18n="btn_close" class="w-full py-3 bg-gray-800 hover:bg-gray-700 text-white rounded-lg font-medium transition-colors">Close</button>
        </div>
    </div>

    <!-- Meeting Request Modal -->
    <div id="meetingModal" class="modal fixed inset-0 z-[100] flex items-center justify-center px-4 bg-black/80 backdrop-blur-sm">
        <div class="bg-brand-gray border border-gray-700 p-8 rounded-2xl max-w-md w-full text-center relative overflow-hidden">
            <div class="absolute top-0 left-0 w-full h-1 bg-gradient-brand"></div>
            <div class="w-16 h-16 bg-brand-yellow/20 rounded-full flex items-center justify-center mx-auto mb-4">
                <i class="fas fa-calendar-check text-brand-yellow text-2xl"></i>
            </div>
            <h3 data-i18n="modal_meet_title" class="text-2xl font-bold text-white mb-2">Request Meeting</h3>
            <p class="text-gray-400 mb-4"><span data-i18n="modal_meet_desc">Requesting a slot for</span> <span id="selectedDate" class="text-white font-bold"></span>.</p>
            
            <form onsubmit="handleMeeting(event)" class="text-left space-y-4">
                <!-- Config Fields -->
                <input type="hidden" name="_template" value="table">
                <input type="hidden" name="_captcha" value="false">
                <input type="hidden" name="_subject" value="Meeting Request">

                <div>
                    <label data-i18n="lbl_time" class="block text-xs font-medium text-gray-500 uppercase mb-1">Preferred Time</label>
                    <select id="meetingTime" name="time" class="w-full bg-black/50 border border-gray-700 rounded p-2 text-white">
                        <option>09:00 AM</option>
                        <option>11:00 AM</option>
                        <option>02:00 PM</option>
                        <option>04:00 PM</option>
                    </select>
                </div>
                <div>
                    <label data-i18n="lbl_email" class="block text-xs font-medium text-gray-500 uppercase mb-1">Email</label>
                    <input id="meetingEmail" name="email" type="email" required class="w-full bg-black/50 border border-gray-700 rounded p-2 text-white" placeholder="you@company.com">
                </div>
                 <!-- Added Company & Position to Meeting Modal -->
                 <div class="grid grid-cols-2 gap-3">
                    <div>
                        <label data-i18n="lbl_company" class="block text-xs font-medium text-gray-500 uppercase mb-1">Company</label>
                        <input id="meetingCompany" name="company" type="text" required class="w-full bg-black/50 border border-gray-700 rounded p-2 text-white" placeholder="Acme Inc.">
                    </div>
                    <div>
                        <label data-i18n="lbl_position" class="block text-xs font-medium text-gray-500 uppercase mb-1">Job Title</label>
                        <input id="meetingPosition" name="job_title" type="text" required class="w-full bg-black/50 border border-gray-700 rounded p-2 text-white" placeholder="Manager">
                    </div>
                </div>
                <div class="flex gap-3 mt-6">
                    <button type="button" onclick="closeModal('meetingModal')" data-i18n="btn_cancel" class="flex-1 py-2 bg-transparent border border-gray-600 text-gray-300 rounded hover:text-white transition-colors">Cancel</button>
                    <button type="submit" data-i18n="btn_confirm" class="flex-1 py-2 bg-gradient-brand text-white font-bold rounded hover:opacity-90 transition-opacity">Confirm</button>
                </div>
            </form>
        </div>
    </div>

    <!-- NEW FEATURE: PROJECT DETAIL MODAL -->
    <!-- This is the 70% semi-translucent card -->
    <div id="projectDetailModal" class="modal fixed inset-0 z-[100] flex items-center justify-center px-4 bg-black/60 backdrop-blur-sm">
        <div class="relative w-full md:w-[70%] max-h-[90vh] overflow-y-auto bg-gray-900/90 backdrop-blur-xl border border-gray-700 rounded-3xl shadow-2xl flex flex-col md:flex-row">
            
            <!-- Close Button -->
            <button onclick="closeModal('projectDetailModal')" class="absolute top-4 right-4 z-50 w-10 h-10 bg-black/50 rounded-full flex items-center justify-center text-white hover:text-brand-orange hover:bg-white/10 transition-colors">
                <i class="fas fa-times"></i>
            </button>

            <!-- Image/Icon Side -->
            <div class="w-full md:w-1/3 bg-black/40 flex items-center justify-center p-12 relative overflow-hidden">
                <div class="absolute inset-0 bg-gradient-brand opacity-10"></div>
                <i id="modalIcon" class="fas fa-cogs text-9xl text-gray-700/50 relative z-10"></i>
            </div>

            <!-- Content Side -->
            <div class="w-full md:w-2/3 p-8 md:p-12 text-left">
                <div id="modalCategory" class="inline-block px-3 py-1 rounded-full border border-gray-600 text-xs font-bold uppercase tracking-wider mb-4 text-brand-yellow">Category</div>
                
                <h2 id="modalTitle" class="text-4xl font-display font-bold text-white mb-6">Project Title</h2>
                
                <div class="space-y-6 text-gray-300 leading-relaxed">
                    <p id="modalDesc">Detailed description goes here.</p>
                    
                    <div class="bg-black/30 rounded-xl p-6 border border-gray-700">
                        <h4 class="text-white font-bold mb-3 border-b border-gray-700 pb-2">Technical Specifications</h4>
                        <ul id="modalSpecs" class="space-y-2 text-sm text-gray-400">
                            <!-- JS injected -->
                        </ul>
                    </div>
                </div>

                <div class="mt-8 pt-6 border-t border-gray-800 flex justify-end">
                    <a href="#contact" onclick="closeModal('projectDetailModal')" class="px-6 py-3 bg-white text-black font-bold rounded-lg hover:bg-brand-orange hover:text-white transition-all">
                        Request Similar Solution
                    </a>
                </div>
            </div>
        </div>
    </div>


    <!-- Scripts -->
    <script>
        const apiKey = ""; // Added for Gemini API
        
        // --- Translation Logic ---
        const translations = {
            en: {
                nav_projects: "Projects",
                nav_services: "Services",
                nav_contact: "Contact Us",
                hero_tag: "Precision Engineering",
                hero_title_1: "Building the",
                hero_title_2: "Core of Industry",
                hero_desc: "Baluarte develops high-precision technology for B2B partners. From automotive fixtures to complex assembly machinery parts.",
                btn_catalog: "View Catalog",
                btn_meeting: "Schedule Meeting",
                
                service_1_title: "Automotive Electronics",
                service_1_desc: "Custom fixtures designed for testing and assembly of sensitive electronic components.",
                service_2_title: "Assembly Machinery",
                service_2_desc: "High-tolerance mechanical parts manufactured for automated assembly lines.",
                service_3_title: "Custom Prototyping",
                service_3_desc: "Rapid development of functional prototypes to validate engineering concepts.",
                
                projects_title: "Our Projects",
                projects_subtitle: "Explore our recent developments in industrial automation and tooling.",
                cat_automotive: "Automotive",
                cat_robotics: "Robotics",
                cat_machinery: "Machinery",
                cat_ev: "EV Tech",
                cat_qc: "Quality Control",
                cat_defense: "Defense",
                
                proj_1_title: "ECU Testing Fixture",
                proj_1_desc: "A high-precision testing rig for automotive Engine Control Units with pneumatic locking.",
                proj_2_title: "Arm End-Effector",
                proj_2_desc: "Custom aluminum grip assembly for a 6-axis industrial robot arm used in packaging.",
                proj_3_title: "Conveyor Drive Shaft",
                proj_3_desc: "Reinforced steel drive shafts manufactured for heavy-load assembly machinery.",
                proj_4_title: "Battery Housing Jig",
                proj_4_desc: "Precision jig for welding electric vehicle battery packs with heat dissipation integration.",
                proj_5_title: "Vision System Mount",
                proj_5_desc: "Adjustable multi-axis mount for automated optical inspection cameras.",
                proj_6_title: "Ruggedized Enclosure",
                proj_6_desc: "Machined aluminum enclosure for field communications equipment.",
                btn_details: "View Details",

                contact_title: "Get in Touch",
                contact_desc: "Ready to start your next engineering project? Send us a message.",
                lbl_name: "Name",
                lbl_email: "Email",
                lbl_company: "Company",
                lbl_position: "Job Title",
                lbl_type: "Project Type",
                lbl_message: "Message",
                pl_message: "Describe your requirements...",
                opt_auto: "Automotive Fixture",
                opt_machine: "Machinery Part",
                opt_proto: "Prototipado",
                opt_other: "Other",
                btn_send: "Send Message",
                btn_sending: "Sending...",
                
                cal_title: "Schedule a Meeting",
                cal_desc: "Book a technical consultation with our engineers.",
                day_su: "Su",
                day_mo: "Mo",
                day_tu: "Tu",
                day_we: "We",
                day_th: "Th",
                day_fr: "Fr",
                day_sa: "Sa",
                cal_info: "Select an available date (highlighted) to request a Google Meet session.",
                footer_rights: "All rights reserved.",
                
                modal_sent_title: "Message Sent",
                modal_sent_desc: "Thank you for contacting Baluarte. Our engineering team will review your inquiry and respond within 24 hours.",
                modal_meet_title: "Request Meeting",
                modal_meet_desc: "Requesting a slot for",
                lbl_time: "Preferred Time",
                btn_cancel: "Cancel",
                btn_confirm: "Confirm",
                btn_close: "Close",

                // AI Features
                chat_title: "Virtual Engineer",
                chat_welcome: "Hello! I'm Baluarte's AI assistant. How can I help you with our fixtures or machinery services today?",
                chat_placeholder: "Ask about our fixtures...",
                btn_enhance: "Enhance with AI ✨",
                ai_enhancing: "Enhancing..."
            },
            es: {
                nav_projects: "Proyectos",
                nav_services: "Servicios",
                nav_contact: "Contáctanos",
                hero_tag: "Ingeniería de Precisión",
                hero_title_1: "Construyendo el",
                hero_title_2: "Núcleo de la Industria",
                hero_desc: "Baluarte desarrolla tecnología de alta precisión para socios B2B. Desde dispositivos automotrices hasta piezas complejas para maquinaria de ensamblaje.",
                btn_catalog: "Ver Catálogo",
                btn_meeting: "Agendar Reunión",
                
                service_1_title: "Electrónica Automotriz",
                service_1_desc: "Dispositivos personalizados diseñados para pruebas y montaje de componentes electrónicos sensibles.",
                service_2_title: "Maquinaria de Ensamblaje",
                service_2_desc: "Piezas mecánicas de alta tolerancia fabricadas para líneas de montaje automatizadas.",
                service_3_title: "Prototipado a Medida",
                service_3_desc: "Desarrollo rápido de prototipos funcionales para validar conceptos de ingeniería.",
                
                projects_title: "Nuestros Proyectos",
                projects_subtitle: "Explore nuestros desarrollos recientes en automatización industrial y herramientas.",
                cat_automotive: "Automotriz",
                cat_robotics: "Robótica",
                cat_machinery: "Maquinaria",
                cat_ev: "Tecnología EV",
                cat_qc: "Control de Calidad",
                cat_defense: "Defensa",
                
                proj_1_title: "Dispositivo de Prueba ECU",
                proj_1_desc: "Banco de pruebas de alta precisión para unidades de control de motor con bloqueo neumático.",
                proj_2_title: "Efector Final Robótico",
                proj_2_desc: "Ensamblaje de agarre de aluminio personalizado para brazo robótico industrial de 6 ejes.",
                proj_3_title: "Eje de Transmisión",
                proj_3_desc: "Ejes de acero reforzado fabricados para maquinaria de ensamblaje de carga pesada.",
                proj_4_title: "Jig de Batería",
                proj_4_desc: "Jig de precisión para soldar paquetes de baterías de vehículos eléctricos con disipación de calor.",
                proj_5_title: "Soporte de Sistema de Visión",
                proj_5_desc: "Soporte multi-eje ajustable para cámaras de inspección óptica automatizada.",
                proj_6_title: "Carcasa Reforzada",
                proj_6_desc: "Carcasa de aluminio mecanizado para equipos de comunicaciones de campo.",
                btn_details: "Ver Detalles",

                contact_title: "Contáctanos",
                contact_desc: "¿Listo para comenzar tu próximo proyecto? Envíanos un mensaje.",
                lbl_name: "Nombre",
                lbl_email: "Correo",
                lbl_company: "Empresa",
                lbl_position: "Puesto",
                lbl_type: "Tipo de Proyecto",
                lbl_message: "Mensaje",
                pl_message: "Describe tus requerimientos...",
                opt_auto: "Dispositivo Automotriz",
                opt_machine: "Pieza de Maquinaria",
                opt_proto: "Prototipado",
                opt_other: "Otro",
                btn_send: "Enviar Mensaje",
                btn_sending: "Enviando...",
                
                cal_title: "Agendar Reunión",
                cal_desc: "Reserva una consulta técnica con nuestros ingenieros.",
                day_su: "Do",
                day_mo: "Lu",
                day_tu: "Ma",
                day_we: "Mi",
                day_th: "Ju",
                day_fr: "Vi",
                day_sa: "Sa",
                cal_info: "Selecciona una fecha disponible (resaltada) para solicitar una sesión de Google Meet.",
                footer_rights: "Todos los derechos reservados.",
                
                modal_sent_title: "Mensaje Enviado",
                modal_sent_desc: "Gracias por contactar a Baluarte. Nuestro equipo de ingeniería revisará su consulta y responderá dentro de 24 horas.",
                modal_meet_title: "Solicitar Reunión",
                modal_meet_desc: "Solicitando espacio para",
                lbl_time: "Hora Preferida",
                btn_cancel: "Cancelar",
                btn_confirm: "Confirmar",
                btn_close: "Cerrar",

                 // AI Features
                chat_title: "Ingeniero Virtual",
                chat_welcome: "¡Hola! Soy el asistente IA de Baluarte. ¿Cómo puedo ayudarte con nuestros dispositivos o maquinaria hoy?",
                chat_placeholder: "Pregunta sobre nuestros dispositivos...",
                btn_enhance: "Mejorar con IA ✨",
                ai_enhancing: "Mejorando..."
            }
        };

        let currentLang = 'en';

        function toggleLanguage() {
            currentLang = currentLang === 'en' ? 'es' : 'en';
            updateContent();
        }

        function updateContent() {
            // Update button text
            const nextLang = currentLang === 'en' ? 'ES' : 'EN';
            document.getElementById('lang-btn-text').innerText = nextLang;
            document.getElementById('lang-btn-text-mobile').innerText = nextLang;

            // Update text elements
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (translations[currentLang][key]) {
                    el.innerText = translations[currentLang][key];
                }
            });

            // Update placeholders
            document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
                const key = el.getAttribute('data-i18n-placeholder');
                if (translations[currentLang][key]) {
                    el.placeholder = translations[currentLang][key];
                }
            });

            // Re-render calendar to update month name
            initCalendar();
        }

        // --- Three.js Background Animation ---
        const initThreeJS = () => {
            const container = document.getElementById('canvas-container');
            if(!container) return;
            const scene = new THREE.Scene();
            scene.fog = new THREE.FogExp2(0x050505, 0.002);

            const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.z = 30;

            const renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            container.appendChild(renderer.domElement);

            const mainGroup = new THREE.Group();
            scene.add(mainGroup);

            const geometry = new THREE.IcosahedronGeometry(10, 1);
            const material = new THREE.MeshBasicMaterial({ 
                color: 0xEA580C, 
                wireframe: true,
                transparent: true,
                opacity: 0.15
            });
            const core = new THREE.Mesh(geometry, material);
            mainGroup.add(core);

            const particlesGeometry = new THREE.BoxGeometry(0.5, 0.5, 0.5);
            const particlesMaterial = new THREE.MeshBasicMaterial({ color: 0xF59E0B }); 

            for (let i = 0; i < 150; i++) {
                const mesh = new THREE.Mesh(particlesGeometry, particlesMaterial);
                mesh.position.x = (Math.random() - 0.5) * 60;
                mesh.position.y = (Math.random() - 0.5) * 60;
                mesh.position.z = (Math.random() - 0.5) * 40;
                mesh.rotation.x = Math.random() * Math.PI;
                mesh.rotation.y = Math.random() * Math.PI;
                mainGroup.add(mesh);
            }

            const lineMaterial = new THREE.LineBasicMaterial({ color: 0xDC2626, opacity: 0.1, transparent: true }); 
            const points = [];
            for(let i=0; i<20; i++) {
                points.push( new THREE.Vector3( (Math.random()-0.5)*40, (Math.random()-0.5)*40, (Math.random()-0.5)*40 ) );
            }
            const lineGeometry = new THREE.BufferGeometry().setFromPoints( points );
            const lines = new THREE.Line( lineGeometry, lineMaterial );
            mainGroup.add(lines);

            const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
            scene.add(ambientLight);

            let mouseX = 0;
            let mouseY = 0;
            let targetRotationX = 0;
            let targetRotationY = 0;

            const windowHalfX = window.innerWidth / 2;
            const windowHalfY = window.innerHeight / 2;

            document.addEventListener('mousemove', (event) => {
                mouseX = (event.clientX - windowHalfX);
                mouseY = (event.clientY - windowHalfY);
            });

            window.addEventListener('resize', () => {
                const width = window.innerWidth;
                const height = window.innerHeight;
                renderer.setSize(width, height);
                camera.aspect = width / height;
                camera.updateProjectionMatrix();
            });

            const animate = () => {
                requestAnimationFrame(animate);

                targetRotationY = mouseX * 0.0005;
                targetRotationX = mouseY * 0.0005;

                mainGroup.rotation.y += 0.05 * (targetRotationY - mainGroup.rotation.y);
                mainGroup.rotation.x += 0.05 * (targetRotationX - mainGroup.rotation.x);

                mainGroup.rotation.z += 0.001;
                core.rotation.y -= 0.002;

                renderer.render(scene, camera);
            };

            animate();
        };

        // --- UI Logic ---
        window.addEventListener('scroll', () => {
            const nav = document.getElementById('navbar');
            if (window.scrollY > 50) {
                nav.classList.add('bg-black/90', 'backdrop-blur-md', 'border-b', 'border-gray-800', 'shadow-lg');
            } else {
                nav.classList.remove('bg-black/90', 'backdrop-blur-md', 'border-b', 'border-gray-800', 'shadow-lg');
            }
        });

        const btn = document.getElementById('mobile-menu-btn');
        const menu = document.getElementById('mobile-menu');

        btn.addEventListener('click', () => {
            menu.classList.toggle('hidden');
        });

        // Calendar Generation
        const initCalendar = () => {
            const grid = document.getElementById('calendarGrid');
            const dateLabel = document.getElementById('currentMonthYear');
            grid.innerHTML = ''; // Clear previous
            
            const now = new Date();
            
            const monthNamesEn = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
            const monthNamesEs = ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"];
            
            const monthNames = currentLang === 'en' ? monthNamesEn : monthNamesEs;
            
            dateLabel.innerText = `${monthNames[now.getMonth()]} ${now.getFullYear()}`;
            
            const daysInMonth = new Date(now.getFullYear(), now.getMonth() + 1, 0).getDate();
            const firstDay = new Date(now.getFullYear(), now.getMonth(), 1).getDay();

            for (let i = 0; i < firstDay; i++) {
                const empty = document.createElement('div');
                grid.appendChild(empty);
            }

            for (let i = 1; i <= daysInMonth; i++) {
                const btn = document.createElement('button');
                btn.className = "h-10 w-full rounded-lg text-sm font-medium transition-all hover:bg-brand-orange hover:text-white focus:outline-none focus:ring-2 focus:ring-brand-yellow";
                
                if (i === now.getDate()) {
                    btn.classList.add('bg-brand-yellow', 'text-black', 'font-bold'); 
                } else if (i < now.getDate()) {
                    btn.classList.add('text-gray-600', 'cursor-not-allowed'); 
                    btn.disabled = true;
                } else {
                    btn.classList.add('text-white', 'bg-gray-800/50');
                    btn.onclick = () => openMeetingModal(i, monthNames[now.getMonth()], now.getFullYear());
                }
                
                btn.innerText = i;
                grid.appendChild(btn);
            }
        };

        // Modal Handlers
        // REMOVED handleContact(e) - replaced by form action="POST"

        function openMeetingModal(day, month, year) {
            document.getElementById('selectedDate').innerText = `${month} ${day}, ${year}`;
            document.getElementById('meetingModal').classList.add('active');
        }

        async function handleMeeting(e) {
            e.preventDefault();
            const form = e.target;
            const btn = form.querySelector('button[type="submit"]');
            const originalTextKey = btn.getAttribute('data-i18n');
            const originalText = translations[currentLang][originalTextKey];
            btn.innerText = "Sending...";
            btn.disabled = true;
            
            // Gather FormData from inputs with names
            const formData = new FormData(form);
            
            // Append the date manually since it's in a SPAN, not an input
            const dateText = document.getElementById('selectedDate').innerText;
            formData.append('meeting_date', dateText);

             // Use FormSubmit AJAX
             try {
                const response = await fetch("https://formsubmit.co/ajax/angelillonura@gmail.com", {
                    method: "POST",
                    body: formData
                });

                if (response.ok) {
                    closeModal('meetingModal');
                    setTimeout(() => {
                        const successTitle = document.querySelector('#successModal h3');
                        const successDesc = document.querySelector('#successModal p');
                        
                        successTitle.innerText = currentLang === 'en' ? "Meeting Requested" : "Reunión Solicitada";
                        successDesc.innerText = currentLang === 'en' 
                            ? "We have received your request and will email you a calendar invite shortly." 
                            : "Hemos recibido su solicitud y le enviaremos una invitación de calendario pronto.";
                        
                        document.getElementById('successModal').classList.add('active');
                        form.reset();
                    }, 500);
                } else {
                    alert("Error sending request.");
                }
            } catch (error) {
                console.error("FormSubmit Error:", error);
                alert("Error sending request.");
            } finally {
                btn.innerText = originalText;
                btn.disabled = false;
            }
        }

        function closeModal(id) {
            document.getElementById(id).classList.remove('active');
            if(id === 'successModal') {
                updateContent(); 
            }
        }

        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.classList.remove('active');
                if(event.target.id === 'successModal') updateContent();
            }
        }

        // --- FOCUS MODE LOGIC (NEW) ---
        function focusService(card) {
            const overlay = document.getElementById('focus-overlay');
            const section = document.getElementById('services');
            
            // Show Overlay
            overlay.classList.remove('opacity-0');
            
            // Lift section above overlay
            section.classList.add('z-[60]');
            
            // Dim other cards
            const allCards = document.querySelectorAll('.service-card');
            allCards.forEach(c => {
                if(c !== card) {
                    c.classList.add('blur-sm', 'opacity-40', 'scale-95');
                } else {
                    // Highlight active card
                    c.classList.add('scale-105', 'z-10', 'ring-2', 'ring-brand-orange/50');
                }
            });
        }

        function blurService(card) {
            const overlay = document.getElementById('focus-overlay');
            const section = document.getElementById('services');
            
            // Hide Overlay
            overlay.classList.add('opacity-0');
            
            // Reset section z-index
            section.classList.remove('z-[60]');
            
            // Reset all cards
            const allCards = document.querySelectorAll('.service-card');
            allCards.forEach(c => {
                c.classList.remove('blur-sm', 'opacity-40', 'scale-95', 'scale-105', 'z-10', 'ring-2', 'ring-brand-orange/50');
            });
        }

        // --- NEW FEATURE: PROJECT DETAIL LOGIC ---
        // Project Data DB
        const projectData = {
            1: {
                title: "ECU Testing Fixture",
                desc: "This custom fixture was engineered for a Tier-1 automotive supplier to test Engine Control Units. It features an integrated pogo-pin cassette mechanism and pneumatic clamps to ensure 100% reliable contact during high-speed production testing.",
                category: "Automotive",
                icon: "fa-car-battery",
                specs: [
                    "Material: Aluminum 6061-T6 (Anodized)",
                    "Cycle Time: < 3 seconds",
                    "Actuation: Pneumatic (5 bar)",
                    "Tolerance: ±0.02mm on pin alignment"
                ]
            },
            2: {
                title: "Arm End-Effector",
                desc: "A lightweight, high-strength end-effector designed for a 6-axis Fanuc robot. Used in a food packaging line, it required food-grade materials and a quick-change system for maintenance.",
                category: "Robotics",
                icon: "fa-robot",
                specs: [
                    "Material: Stainless Steel 304 & Delrin",
                    "Payload Capacity: 5.5 kg",
                    "Gripping Force: Adjustable (20-80N)",
                    "Weight: 850g"
                ]
            },
            3: {
                title: "Conveyor Drive Shaft",
                desc: "Heavy-duty drive shaft replacement for a mining conveyor system. Machined from hardened steel and subjected to stress-relieving heat treatment to withstand extreme torsion.",
                category: "Machinery",
                icon: "fa-gears",
                specs: [
                    "Material: 4140 Alloy Steel (Hardened)",
                    "Length: 1200mm",
                    "Diameter: 85mm",
                    "Treatment: Induction Hardening (HRC 55)"
                ]
            },
            4: {
                title: "Battery Housing Jig",
                desc: "A complex welding jig for EV battery modules. It incorporates active air cooling channels within the fixture body to prevent thermal warping of the battery cells during the laser welding process.",
                category: "EV Tech",
                icon: "fa-charging-station",
                specs: [
                    "Material: Copper Alloy & Steel",
                    "Cooling: Integrated Air Channels",
                    "Insulation: PEEK inserts",
                    "Accuracy: ±0.05mm flatness"
                ]
            },
            5: {
                title: "Vision System Mount",
                desc: "A 4-axis adjustable mount for Cognex vision cameras. This mount allows operators to fine-tune the camera angle and focal distance without tools, using precision micrometers.",
                category: "Quality Control",
                icon: "fa-microscope",
                specs: [
                    "Adjustment: X, Y, Z, Yaw",
                    "Resolution: 0.1mm per turn",
                    "Locking: Thumb screws",
                    "Vibration Damping: Rubber isolated base"
                ]
            },
            6: {
                title: "Ruggedized Enclosure",
                desc: "A custom CNC-machined enclosure for military-grade communication radios. Designed to be IP68 rated and withstand substantial shock and vibration loads.",
                category: "Defense",
                icon: "fa-shield-alt",
                specs: [
                    "Material: Aluminum 7075-T6",
                    "Finish: Hardcoat Anodize (Type III)",
                    "Sealing: EMI/RFI Shielding Gaskets",
                    "Standard: MIL-STD-810G Compliant"
                ]
            }
        };

        function openProjectDetails(id) {
            const data = projectData[id];
            if(!data) return;

            // Populate Modal
            document.getElementById('modalTitle').innerText = data.title;
            document.getElementById('modalDesc').innerText = data.desc;
            document.getElementById('modalCategory').innerText = data.category;
            
            // Icon
            const iconEl = document.getElementById('modalIcon');
            iconEl.className = `fas ${data.icon} text-9xl text-gray-700/50 relative z-10`;

            // Specs
            const specsList = document.getElementById('modalSpecs');
            specsList.innerHTML = '';
            data.specs.forEach(spec => {
                const li = document.createElement('li');
                li.innerHTML = `<i class="fas fa-check text-brand-orange mr-2 text-xs"></i> ${spec}`;
                specsList.appendChild(li);
            });

            // Show Modal
            document.getElementById('projectDetailModal').classList.add('active');
        }

        // --- GEMINI API INTEGRATION ---

        async function callGemini(prompt, systemInstruction = "You are a helpful assistant.") {
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{ text: prompt }]
                        }],
                        systemInstruction: {
                            parts: [{ text: systemInstruction }]
                        }
                    })
                });

                if (!response.ok) {
                    throw new Error('API request failed');
                }

                const data = await response.json();
                return data.candidates[0].content.parts[0].text;
            } catch (error) {
                console.error("Gemini API Error:", error);
                return "I'm sorry, I'm having trouble connecting to the network right now. Please try again later.";
            }
        }

        // Feature 1: Chatbot
        function toggleChat() {
            const chatWin = document.getElementById('chatWindow');
            if(chatWin.classList.contains('hidden')) {
                chatWin.classList.remove('hidden');
                setTimeout(() => {
                    chatWin.classList.remove('scale-95', 'opacity-0');
                    chatWin.classList.add('scale-100', 'opacity-100');
                }, 10);
            } else {
                chatWin.classList.remove('scale-100', 'opacity-100');
                chatWin.classList.add('scale-95', 'opacity-0');
                setTimeout(() => {
                    chatWin.classList.add('hidden');
                }, 300);
            }
        }

        async function handleChatSubmit(e) {
            e.preventDefault();
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            if(!message) return;

            // Add user message to UI
            addChatMessage(message, 'user');
            input.value = '';

            // Show typing indicator
            const typingId = addTypingIndicator();

            // Prepare system prompt with company context
            const context = `
                You are a Senior Engineer consultant for Baluarte.
                Baluarte is a company specializing in:
                1. Automotive Electronics Fixtures (ECU testing, etc).
                2. Assembly Machinery Parts (Conveyor shafts, gears).
                3. Custom Prototyping (Aluminum, Steel).
                4. EV Technology (Battery housing jigs).
                5. Quality Control (Vision system mounts).
                
                Answer the user's technical questions concisely and professionally.
                If they ask for a quote, suggest they use the "Schedule Meeting" form on the left.
                The user language is likely: ${currentLang === 'en' ? 'English' : 'Spanish'}. Reply in that language.
            `;

            const response = await callGemini(message, context);
            
            // Remove typing indicator and add AI response
            removeChatMessage(typingId);
            addChatMessage(response, 'ai');
        }

        function addChatMessage(text, sender) {
            const container = document.getElementById('chatMessages');
            const div = document.createElement('div');
            div.className = "flex items-start gap-3 chat-enter";
            
            if(sender === 'ai') {
                div.innerHTML = `
                    <div class="w-6 h-6 bg-brand-orange/20 rounded-full flex items-center justify-center flex-shrink-0 mt-1">
                        <i class="fas fa-robot text-brand-orange text-xs"></i>
                    </div>
                    <div class="bg-gray-800 text-gray-200 text-sm p-3 rounded-2xl rounded-tl-none border border-gray-700 max-w-[85%]">
                        ${marked.parse(text)}
                    </div>
                `;
            } else {
                div.classList.add('justify-end');
                div.innerHTML = `
                    <div class="bg-brand-orange text-white text-sm p-3 rounded-2xl rounded-tr-none max-w-[85%]">
                        ${text}
                    </div>
                `;
            }
            container.appendChild(div);
            container.scrollTop = container.scrollHeight;
        }

        function addTypingIndicator() {
            const container = document.getElementById('chatMessages');
            const id = 'typing-' + Date.now();
            const div = document.createElement('div');
            div.id = id;
            div.className = "flex items-start gap-3 chat-enter";
            div.innerHTML = `
                <div class="w-6 h-6 bg-brand-orange/20 rounded-full flex items-center justify-center flex-shrink-0 mt-1">
                    <i class="fas fa-robot text-brand-orange text-xs"></i>
                </div>
                <div class="bg-gray-800 p-3 rounded-2xl rounded-tl-none border border-gray-700 flex gap-1 items-center h-10">
                    <div class="w-2 h-2 bg-gray-400 rounded-full typing-dot"></div>
                    <div class="w-2 h-2 bg-gray-400 rounded-full typing-dot"></div>
                    <div class="w-2 h-2 bg-gray-400 rounded-full typing-dot"></div>
                </div>
            `;
            container.appendChild(div);
            container.scrollTop = container.scrollHeight;
            return id;
        }

        function removeChatMessage(id) {
            const el = document.getElementById(id);
            if(el) el.remove();
        }

        // Feature 2: Message Enhancer
        async function enhanceMessage() {
            const textarea = document.getElementById('contactMessage');
            const originalText = textarea.value;
            const btnText = document.getElementById('enhanceBtnText');
            const icon = document.getElementById('enhanceIcon');
            
            if (!originalText) {
                // Shake effect if empty
                textarea.classList.add('ring-2', 'ring-red-500');
                setTimeout(() => textarea.classList.remove('ring-2', 'ring-red-500'), 500);
                return;
            }

            // UI Loading State
            const originalBtnLabel = btnText.innerText;
            btnText.innerText = translations[currentLang]['ai_enhancing'];
            icon.classList.remove('fa-sparkles');
            icon.classList.add('fa-spinner', 'fa-spin');

            const systemPrompt = `
                You are a professional engineering technical writer.
                Rewrite the user's inquiry to be more professional, precise, and technical using standard industry terminology.
                Keep it concise.
                Maintain the same language as the input (English or Spanish).
                Do not add introductory text like "Here is the rewritten version:". Just give the text.
            `;

            const enhancedText = await callGemini(originalText, systemPrompt);

            // Update UI
            textarea.value = enhancedText;
            btnText.innerText = originalBtnLabel;
            icon.classList.remove('fa-spinner', 'fa-spin');
            icon.classList.add('fa-check');
            
            // Flash effect on textarea
            textarea.classList.add('bg-brand-orange/20');
            setTimeout(() => {
                textarea.classList.remove('bg-brand-orange/20');
                icon.classList.remove('fa-check');
                icon.classList.add('fa-sparkles');
            }, 1000);
        }

        // Initialize
        window.addEventListener('DOMContentLoaded', () => {
            initThreeJS();
            initCalendar();
            // Set initial button text based on default lang (EN) so button shows option to switch to ES
            document.getElementById('lang-btn-text').innerText = "ES";
            document.getElementById('lang-btn-text-mobile').innerText = "ES";
        });

    </script>
</body>
</html>
